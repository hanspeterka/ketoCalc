<script type="text/javascript">
application.register("daily-plan", class extends Stimulus.Controller {
	static get targets() {
		return ["diets", "recipes", "percentage", "submit", "recipesTable"]
	}

	connect() {
		this.load_recipes();
	}

	load_recipes(){
		this.submitTarget.disabled=true;
		fetch("{{ url_for('DailyPlansView:load_recipes_AJAX') }}",{
			method: 'POST',
			body: JSON.stringify({'diet_id' : this.dietsTarget.value}),
			headers: {'Content-Type': 'application/json,charset=UTF-8'}}
		).then((response) => {
			return response.json(); }
		).then((response) => {
			this.clear_recipe_options();
			for (let i = 0, recipe; recipe = response[i]; i++) {
				this.add_recipe_option(recipe);
			}
			this.submitTarget.disabled=false;
		}).catch((error) => {
			console.error('Error:', error);
		});
	}

	set_amount(){
	    var percentage = 100;

        if (event != undefined){
          event.preventDefault();
          var target = event.target
          if ("percentage" in target.dataset){
          	percentage = target.dataset.percentage;
          	this.percentageTarget.value = percentage
          }
        }
	}

	_remove_options(selectElement) {
	   var i, L = selectElement.options.length - 1;
	   for(i = L; i >= 0; i--) {
	      selectElement.remove(i);
	   }
	}

	clear_recipe_options(){
		this._remove_options(this.recipesTarget);
	}

	add_recipe_option(recipe){
	    var option = document.createElement('option');
	    option.value = recipe.id;
	    option.innerHTML = recipe.name;
	    this.recipesTarget.appendChild(option);
	}


});
</script>